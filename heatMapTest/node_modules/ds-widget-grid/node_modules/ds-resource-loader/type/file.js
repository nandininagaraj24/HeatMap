
var $ROOT_DIR = require('path').dirname(require.main.filename);

var util = require('util'),
    FS = require('fs'),
    path = require('path'),
    BaseLoad = require("../load");

var Load = module.exports = function (resource, context) {

    BaseLoad.call(this, resource, context);
};

util.inherits(Load, BaseLoad);

// load
(function () {

    this.load = function () {

        var target = this.resource.target,
            that = this;

        var uri = path.join($ROOT_DIR, target);

        process.nextTick(function () {
            if (FS.existsSync(uri)) {

                return FS.readFile(uri, 'utf8', function (err, data) {

                    if (err)
                        return that.emit("error", err);

                    that.emit("done", data);
                });
            }

            that.emit("error", "File not found: " + target);
        });

        return this;
    }
}).call(Load.prototype);